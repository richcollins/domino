Object_clone=function(a){Proto_constructor.prototype=a;return new Proto_constructor};Object_shallowCopy=function(c){var a={};for(var b in c){if(c.hasOwnProperty(b)){a[b]=c[b]}}return a};Arguments_asArray=function(a){return Array.prototype.slice.call(a)};if(!Array.prototype.forEach){Array.prototype.forEach=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var d=arguments[1];for(var c=0;c<a;c++){if(c in this){b.call(d,this[c],c,this)}}}}String.prototype.asCapitalized=function(){return this.replace(/\b[a-z]/g,function(a){return a.toUpperCase()})};Proto=new Object;Proto.setSlot=function(a,b){this[a]=b;return this};Proto.uniqueIdCounter=0;Proto.setSlots=function(b){for(name in b){if(b.hasOwnProperty(name)){var a=b[name];if(typeof(a)=="function"){var c={protoName:this._type,methodName:name};a.functionInfo=c;a.name=this._type+"."+name}this.setSlot(name,a)}}if(b.hasOwnProperty("toString")){this.toString=b.toString}return this};Proto_constructor=new Function;Proto.setSlots({constructor:new Function,clone:function(){Proto_constructor.prototype=this;var a=new Proto_constructor;a._proto=this;a._uniqueId=++Proto.uniqueIdCounter;if(a.init){a.init()}return a},uniqueId:function(){return this._uniqueId},proto:function(){return this._proto},removeSlots:function(){this.argsAsArray(arguments).forEach(function(a){delete this["_"+name];delete this[name];delete this["set"+name.asCapitalized()]});return this},setSlotsIfAbsent:function(a){for(name in a){if(!this[name]&&a.hasOwnProperty(name)){this.setSlot(name,a[name])}}if(a.hasOwnProperty("toString")){this.toString=a.toString}return this},printSlotCalls:function(){var c=[];for(var a in SlotCalls){var d={};d.name=a;d.count=SlotCalls[a];c.push(d)}c.sort(function(e,f){return e.count-f.count});for(var b=0;b<c.length;b++){Logger.log(c[b].name+":"+c[b].count)}},newSlot:function(b,a){if(typeof(b)!="string"){throw"name must be a string"}if(a===undefined){a=null}this["_"+b]=a;this[b]=function(){return this["_"+b]};this["set"+b.asCapitalized()]=function(c){this["_"+b]=c;return this};return this},aliasSlot:function(a,b){this[b]=this[a];this["set"+b.asCapitalized()]=this["set"+a.asCapitalized()];return this},argsAsArray:function(a){return Array.prototype.slice.call(a)},newSlots:function(){var b=this.argsAsArray(arguments);var a={};if(b.length>1||typeof(b[0])=="string"){b.forEach(function(c){a[c]=null})}else{a=b[0]}for(slotName in a){this.newSlot(slotName,a[slotName])}return this},newNumberSlot:function(b,a){this.newSlot(b,a||0);this["inc"+b.asCapitalized()+"By"]=function(c){this["_"+b]+=c};this["inc"+b.asCapitalized()]=function(){this["_"+b]++};this["dec"+b.asCapitalized()+"By"]=function(c){this["_"+b]-=c};this["dec"+b.asCapitalized()]=function(){this["_"+b]--};return this},newNumberSlots:function(){this.argsAsArray(arguments).forEach(function(a){this.newNumberSlot(a)},this);return this},forEachSlot:function(b){for(var a in this){if(this.hasOwnProperty(a)){b(this[a],a)}}return this},canPerform:function(a){return this[a]&&typeof(this[a])=="function"},performWithArgList:function(b,a){return this[b].apply(this,a)},perform:function(a){return this[a].apply(this,this.argsAsArray(arguments).slice(1))},conditionallyPerform:function(a){if(this[a]&&this[a].call){return this.perform.apply(this,arguments)}else{return null}},performSets:function(b){for(var a in b){if(b.hasOwnProperty(a)){this.conditionallyPerform("set"+a.asCapitalized(),b[a])}}return this}});Proto.newSlot("type","Proto");Proto.newSlot("sender",null);Proto.removeSlot=Proto.removeSlots;Browser=Proto.clone().setSlots({userAgent:function(){if(typeof window!="undefined"&&typeof window.navigator!="undefined"){return window.navigator.userAgent}else{return""}},isInternetExplorer:function(){return navigator.appName.indexOf("Internet Explorer")>-1},isIE8:function(){return this.userAgent().indexOf("MSIE 8.0")!=-1},isIE6:function(){return this.isInternetExplorer()&&!window.XMLHttpRequest},isGecko:function(){return this.userAgent().indexOf("Gecko")!=-1},isSafari:function(){return this.userAgent().indexOf("Safari")!=-1},version:function(){if(this.isGecko()){var a=this.userAgent().indexOf("Firefox");return(a==-1)?2:parseFloat(this.userAgent().substring(a+"Firefox".length+1))}else{return null}},locationAsUri:function(){return Uri.withString(window.location.href)}});(function(){for(var a in Proto){[Array,String,Number,Date].forEach(function(b){if(b==Array&&a=="clone"&&Browser.isInternetExplorer()){b.prototype[a]=function(){throw new Error("You can't clone an Array proto in IE yet.")}}else{b.prototype[a]=Proto[a]}b.clone=function(){return new b}})}})();Importer=Proto.clone().setType("Importer").newSlots({basePath:null}).setSlots({importPaths:function(c){for(var a=0;a<c.length;a++){if(this.basePath()){var b=this.basePath()+"/"+c[a]}else{var b=c[a]}b=b+".js";document.write('<script src="'+b+'"><\/script>')}}});Array.prototype.setSlotsIfAbsent({init:function(){var a=[0,this.length];a.concatInPlace(this.slice());this.splice.apply(this,a)},empty:function(){this.splice(0,this.length);return this},isEmpty:function(){return this.length==0},concatInPlace:function(a){this.push.apply(this,a)},at:function(a){if(a>0){return this[a]}else{return this[this.length+a]}},removeElements:function(a){a.forEach(function(b){this.remove(b)},this);return this},append:function(a){this.push(a);return this},appendAll:function(b){var a=this;b.forEach(function(c){a.push(c)});return this},prepend:function(a){this.unshift(a);return this},remove:function(b){var a=this.indexOf(b);if(a>-1){this.removeAt(a)}return this},removeAt:function(a){this.splice(a,1);return this},copy:function(){return this.slice()},first:function(){return this[0]},rest:function(){var b=this.copy();b.removeFirst();return b},last:function(){return this[this.length-1]},pushIfAbsent:function(){console.log("pushIfAbsent is deprecated.  Use appendIfAbsent instead.");return this.appendIfAbsent.apply(this,arguments)},appendIfAbsent:function(){var a=this;this.argsAsArray(arguments).forEach(function(b){if(a.indexOf(b)==-1){a.push(b)}});return this},split:function(e){var c=[];var d=Math.ceil(this.length/e);for(var b=0;b<this.length;b+=d){var f=this.slice(b,b+d);if(f.length<d){var a=c.pop();if(a){f=a.concat(f)}}c.push(f)}return c},map:function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var e=new Array(a);var d=arguments[1];for(var c=0;c<a;c++){if(c in this){e[c]=b.call(d,this[c],c,this)}}return e},shuffle:function(){var b=this.length;if(b==0){return false}while(--b){var a=Math.floor(Math.random()*(b+1));var d=this[b];var c=this[a];this[b]=c;this[a]=d}},forEachCall:function(b){var a=this.argsAsArray(arguments).slice(1);a.push(0);this.forEach(function(d,c){a[a.length-1]=c;d[b].apply(d,a)});return this},forEachPerform:function(){return this.forEachCall.apply(this,arguments)},sortByCalling:function(b){var a=this.argsAsArray(arguments).slice(1);return this.sort(function(d,f){var e=d[b].apply(d,a);var c=f[b].apply(f,a);if(e<c){return -1}else{if(c<e){return 1}else{return 0}}})},mapByCalling:function(){console.log("mapByCalling is deprecated.  Use mapByPerforming instead.");return this.mapByPerforming.apply(this,arguments)},mapPerform:function(a){var b=this.argsAsArray(arguments).slice(1);b.push(0);return this.map(function(d,c){b[b.length-1]=c;return d[a].apply(d,b)})},detectByCalling:function(){console.log("detectByCalling is deprecated.  Use detectByPerforming instead.");return this.detectByPerforming.apply(this,arguments)},detectByPerforming:function(b){var a=this.argsAsArray(arguments).slice(1);return this.detect(function(d,c){return d[b].apply(d,a)})},reduce:function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}if(a==0&&arguments.length==1){throw new TypeError()}var c=0;if(arguments.length>=2){var d=arguments[1]}else{do{if(c in this){d=this[c++];break}if(++c>=a){throw new TypeError()}}while(true)}for(;c<a;c++){if(c in this){d=b.call(null,d,this[c],c,this)}}return d},filter:function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var e=new Array();var d=arguments[1];for(var c=0;c<a;c++){if(c in this){var f=this[c];if(b.call(d,f,c,this)){e.push(f)}}}return e},filterByPerforming:function(a){var b=this.argsAsArray(arguments).slice(1);b.push(0);return this.filter(function(d,c){b[b.length-1]=c;return d[a].apply(d,b)})},detect:function(b){for(var a=0;a<this.length;a++){if(b(this[a])){return this[a]}}return null},detectIndex:function(b){for(var a=0;a<this.length;a++){if(b(this[a])){return a}}return null},max:function(f){var a=undefined;var c=undefined;var e=this.length;for(var d=0;d<e;d++){var b=this[d];if(f){b=f(b)}if(a==undefined||b>a){a=b;c=this[d]}}return c},maxIndex:function(f){var a=undefined;var c=0;var e=this.length;for(var d=0;d<e;d++){var b=this[d];if(f){b=f(b)}if(a==undefined||b>a){a=b;c=d}}return c},min:function(f){var a=undefined;var c=undefined;var e=this.length;for(var d=0;d<e;d++){var b=this[d];if(f){b=f(b)}if(a==undefined||b<a){a=b;c=this[d]}}return c},minIndex:function(f){var a=undefined;var c=0;var e=this.length;for(var d=0;d<e;d++){var b=this[d];if(f){b=f(b)}if(a==undefined||b<a){a=b;c=d}}return c},sum:function(f){var a=undefined;var d=0;var e=this.length;for(var c=0;c<e;c++){var b=this[c];if(f){b=f(b)}d=d+b}return d},some:function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var d=arguments[1];for(var c=0;c<a;c++){if(c in this&&b.call(d,this[c],c,this)){return true}}return false},every:function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var d=arguments[1];for(var c=0;c<a;c++){if(c in this&&!b.call(d,this[c],c,this)){return false}}return true},allRespondTrue:function(a){return this.every(function(b){return b.perform(a)})},firstRespondingTrue:function(a){return this.detect(function(b){return b.perform(a)})},indexOf:function(b){var a=this.length;var c=Number(arguments[1])||0;c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c++){if(c in this&&this[c]===b){return c}}return -1},contains:function(a){return this.indexOf(a)>-1},removeFirst:function(){return this.shift()},removeLast:function(){return this.pop()},hasPrefix:function(b){if(this.length<b.length){return false}for(var a=0;a<this.length;a++){if(this[a]!=b[a]){return false}}return true},toString:function(){var b="[";for(var a=0;a<this.length;a++){var c=this[a];if(a!=0){b=b+","}if(typeof(c)=="string"){b=b+'"'+c+'"'}else{b=b+c}}return b+"]"},isEqual:function(b){if(this.length!=b.length){return false}for(var a=0;a<this.length;a++){if(this[a]!=b[a]){return false}}return true},elementWith:function(a,b){var c=this[this.mapPerform(a).indexOf(b)];return c===undefined?null:c},atInsert:function(a,b){this.splice(a,0,b)},size:function(){return this.length},itemAfter:function(a){var b=this.indexOf(a);if(b==-1){return null}b=b+1;if(b>this.length-1){return null}if(this[b]!=undefined){return this[b]}return null},itemBefore:function(a){var b=this.indexOf(a);if(b==-1){return null}b=b-1;if(b<0){return null}if(this[b]){return this[b]}return null}});Number.prototype.setSlots({cssString:function(){return this.toString()},milliseconds:function(){return this},repeat:function(b){for(var a=0;a<this;a++){b(a)}return this},map:function(){var b=[];for(var c=0;c<this;c++){b.push(c)}return Array.prototype.map.apply(b,arguments)},isEven:function(){return this%2==0}});String.prototype.setSlotsIfAbsent({cssString:function(){return this},replaceSeq:function(d,c){var f=this;var e;if(c.contains(d)){throw"substring contains replace string"}while(true){var e=f.replace(d,c);if(e==f){return e}f=e}return this},repeated:function(c){var a="";var b=this;c.repeat(function(){a+=b});return a},isEmpty:function(){return this.length==0},beginsWith:function(a){if(!a){return false}return this.indexOf(a)==0},removePrefix:function(a){return this.substring(this.beginsWith(a)?a.length:0)},endsWith:function(b){var a=this.lastIndexOf(b);return(a>-1)&&(this.lastIndexOf(b)==this.length-b.length)},removeSuffix:function(a){if(this.endsWith(a)){return this.substr(0,this.length-a.length)}else{return this}},trim:function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},hostName:function(){var a=this.removePrefix("http://");return a.slice(0,a.indexOf("/"))},contains:function(a){return this.indexOf(a)>-1},before:function(a){var b=this.indexOf(a);if(b==-1){return this}return this.slice(0,b)},after:function(a){var b=this.indexOf(a);if(b==-1){return this}return this.slice(b+1)},asUncapitalized:function(){return this.replace(/\b[A-Z]/g,function(a){return a.toLowerCase()})},asCapitalized:function(){return this.replace(/\b[A-Z]/g,function(a){return a.toUpperCase()})},containsCapitals:function(){return this.search(/[A-Z]/g)>-1},charAt:function(a){return this.slice(a,a+1)},first:function(){return this.slice(0,1)},asNumber:function(){return Number(this)},stringCount:function(a){return this.split(a).length-1},lineCount:function(){return this.stringCount("\n")},pathComponents:function(){return this.split("/")},sansLastPathComponent:function(){var a=this.pathComponents();a.removeLast();return a.join("/")},lastPathComponent:function(){return this.pathComponents().last()},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},fileNameSuffix:function(){var a=this.split(".").last();return a}});Color=Proto.clone().newSlots({red:0,green:0,blue:0,alpha:1}).setSlots({withRGB:function(e,d,a){var f=this.clone();f.setRed(e);f.setGreen(d);f.setBlue(a);return f}});Color.setSlots({Transparent:Color.clone().setAlpha(0),White:Color.clone().setRed(255).setGreen(255).setBlue(255),LightGray:Color.clone().setRed(212).setGreen(212).setBlue(212),Gray:Color.clone().setRed(127).setGreen(127).setBlue(127),DimGray:Color.clone().setRed(105).setGreen(105).setBlue(105),Black:Color.clone(),});Delegator=Proto.clone().newSlots({type:"Delegator",delegate:null,messagesDelegate:true}).setSlots({delegatePerform:function(b){if(this.messagesDelegate()){var a=Arguments_asArray(arguments).slice(1);a.unshift(this);var c=this.delegate();if(c&&c.canPerform(b)){return c.performWithArgList(b,a)}}}});StyleSlot=Proto.clone().newSlots({view:null,name:null,styleName:null,value:null,transformation:null}).setSlots({addToView:function(){var a=this.view();var b=this.name();var c=this.styleName();var e=this.value();var d=this.transformation();a[b]=function(){return this["_"+b]};a["set"+b.asCapitalized()]=function(f){this["_"+b]=f;if(d){this.element().style[c]=d.apply(f)}else{this.element().style[c]=f}};a["_"+b]=e;a.styleSlots().append(this)}});ColorTransformation=Proto.clone().setSlots({apply:function(a){return"rgba("+[a.red(),a.green(),a.blue(),a.alpha()].join(",")+")"}});SuffixTransformation=Proto.clone().setSlots({apply:function(a){return a+this.suffix}});RoundedSuffixTransformation=Proto.clone().setSlots({apply:function(a){return Math.round(a)+this.suffix}});View=Delegator.clone().newSlots({type:"View",superview:null,subviews:[],element:null,elementName:"div",resizesLeft:false,resizesRight:false,resizesWidth:false,resizesTop:false,resizesBottom:false,resizesHeight:false,styleSlots:[]}).setSlot("newStyleSlots",function(c){for(var a in c){var e=c[a];var b=StyleSlot.clone();b.setView(this);b.setName(a);b.setStyleName(e.name||a);b.setValue(e.value);if(e.transformation){var d=window[e.transformation.name.asCapitalized()+"Transformation"];if(d){b.setTransformation(d.clone().setSlots(e.transformation))}}b.addToView()}return this}).newStyleSlots({x:{name:"left",value:0,transformation:{name:"roundedSuffix",suffix:"px"}},y:{name:"top",value:0,transformation:{name:"roundedSuffix",suffix:"px"}},width:{value:0,transformation:{name:"roundedSuffix",suffix:"px"}},height:{value:0,transformation:{name:"roundedSuffix",suffix:"px"}},backgroundColor:{value:Color.Transparent,transformation:{name:"color"}},visibility:"visible"});View.setSlots({init:function(){this.setStyleSlots(this.styleSlots().copy());this.createElement();this.initElement();this.setSubviews(this.subviews().copy())},createElement:function(){var a=document.createElement(this.elementName());a.style.position="absolute";a.style.overflow="hidden";this.setElement(a)},initElement:function(){var a=this;this.styleSlots().forEach(function(b){a.perform("set"+b.name().asCapitalized(),a.perform(b.name()))})},setHidden:function(a){this.setVisibility(a?"hidden":"visible")},hidden:function(){return this.visibility()=="hidden"},preventDefault:function(a){if(a.preventDefault){a.preventDefault()}else{if(a.returnValue){a.returnValue=false}}},removeAllSubviews:function(){var a=this;this.subviews().copy().forEach(function(b){a.removeSubview(b)})},removeSubview:function(a){if(!a){return this}if(a.superview()!=this){throw"view is not a subview"}this.subviews().remove(a);a.setSuperview(null);this.element().removeChild(a.element())},addSubview:function(b){var a=b.superview();if(a){a.removeSubview(b)}b.setSuperview(this);this.subviews().append(b);this.element().appendChild(b.element())},addSubviews:function(){var a=this;Arguments_asArray(arguments).forEach(function(b){a.addSubview(b)})},rightEdge:function(){return this.x()+this.width()},bottomEdge:function(){return this.y()+this.height()},moveRightOf:function(a,b){this.setX(a.rightEdge()+b)},moveBelow:function(a,b){this.setY(a.bottomEdge()+b)},alignTopTo:function(a){this.setY(a.y())},alignMiddleTo:function(a){this.setY(a.y()+0.5*a.height()-0.5*this.height())},alignBottomTo:function(a){this.setY(a.bottomEdge()-this.height()-1)},alignRightTo:function(a){this.setX(a.rightEdge()-this.width()-1)},center:function(){this.centerHorizontally();this.centerVertically();return this},centerHorizontally:function(){var a=this.superview();if(a){this.setX((a.width()-this.width())/2)}},centerVertically:function(){var a=this.superview();if(a){this.setY((a.height()-this.height())/2)}},_setWidth:View.setWidth,setWidth:function(b){var a=this.width();this._setWidth(b);this.subviews().forEachPerform("autoResizeWidth",a)},autoResizeWidth:function(c){var b=this.superview().width();var a=this.width();if(this.resizesLeft()){if(this.resizesRight()){if(this.resizesWidth()){this.setWidth(a*b/c)}this.setX(this.x()*(b-this.width())/(c-a))}else{if(this.resizesWidth()){this.setWidth(a*b/c)}this.setX(this.x()+a+b-this.width()-c)}}else{if(this.resizesRight()){if(this.resizesWidth()){this.setWidth(a*b/c)}}else{if(this.resizesWidth()){this.setWidth(b-(c-a))}}}},_setHeight:View.setHeight,setHeight:function(a){var b=this.height();this._setHeight(a);this.subviews().forEachPerform("autoResizeHeight",b)},autoResizeHeight:function(c){var a=this.superview().height();var b=this.height();if(this.resizesTop()){if(this.resizesBottom()){if(this.resizesHeight()){this.setHeight(b*a/c)}this.setY(this.y()*(a-this.height())/(c-b))}else{if(this.resizesHeight()){this.setHeight(b*a/c)}this.setY(this.y()+b+a-this.height()-c)}}else{if(this.resizesBottom()){if(this.resizesHeight()){this.setHeight(b*a/c)}}else{if(this.resizesHeight()){this.setHeight(a-(c-b))}}}},autoResize:function(b,a){this.autoResizeWidth(b);this.autoResizeHeight(a)},resizeCentered:function(){this.resizeCenteredHorizontally(true);this.resizeCenteredVertically(true)},resizeCenteredHorizontally:function(){this.setResizesLeft(true);this.setResizesRight(true)},resizeCenteredVertically:function(){this.setResizesTop(true);this.setResizesBottom(true)},resizeToFill:function(){this.setResizesWidth(true);this.setResizesHeight(true)},sizingElement:function(){var b=this.element().cloneNode(true);var a=b.style;a.position="fixed";a.width="";a.height="";a.top=screen.height+"px";document.body.appendChild(b);return b},sizeWidthToFit:function(){var b=this.sizingElement();var a=b.style;this.setWidth(b.clientWidth);document.body.removeChild(b)},sizeHeightToFit:function(){var b=this.sizingElement();var a=b.style;a.width=this.width()+"px";this.setHeight(b.clientHeight);document.body.removeChild(b)},sizeToFit:function(){this.sizeWidthToFit();this.sizeHeightToFit()}});Window=View.clone().newSlots({type:"Window",lastResizeWidth:null,lastResizeHeight:null}).setSlots({init:function(){View.init.call(this);document.body.innerHTML="";this.setLastResizeWidth(this.width());this.setLastResizeHeight(this.height());window.onresize=function(){Window.autoResize()}},createElement:function(){this.setElement(document.body)},initElement:function(){},width:function(){return this.element().clientWidth},height:function(){return this.element().clientHeight},autoResize:function(){this.subviews().forEachPerform("autoResize",this.lastResizeWidth(),this.lastResizeHeight());this.setLastResizeWidth(this.width());this.setLastResizeHeight(this.height())}});Label=View.clone().newSlots({type:"Label",text:null}).newStyleSlots({fontFamily:{value:"Helvetica, Arial, sans-serif"},fontSize:{value:15,transformation:{name:"suffix",suffix:"px"}},fontWeight:{value:"normal"},textDecoration:{value:"none"},color:{value:Color.Black,transformation:{name:"color"}},textOverflow:{value:"ellipsis"},whiteSpace:{value:"pre"}}).setSlots({setText:function(a){this._text=a;this.element().innerText=a}});TextField=Label.clone().newSlots({type:"TextField"}).setSlots({initElement:function(){View.initElement.call(this);var b=this.element();b.contentEditable=true;b.style.outline="none";var a=this;b.onkeydown=function(c){if(c.keyCode==13){a.preventDefault(c);a.element().blur()}};b.onblur=function(c){if(!(a.delegate()&&a.delegate().canPerform("textFieldShouldEndEditing"))||a.delegatePerform("textFieldShouldEndEditing")){a.delegatePerform("textFieldEditingEnded",a)}else{setTimeout(function(){a.focus();a.selectAll()})}}},text:function(){return this.element().innerText},sizingElement:function(){var a=Label.sizingElement.call(this);a.contentEditable=false;return a},selectAll:function(){var a=document.createRange();a.selectNodeContents(this.element());var b=window.getSelection();b.removeAllRanges();b.addRange(a)},focus:function(){this.element().focus()},value:function(){return this.text()},setValue:function(a){this.setText(a)}});Button=Label.clone().newSlots({type:"Button"}).setSlots({initElement:function(){View.initElement.call(this);var a=this;var b=this.element();b.onclick=function(){a.delegate().conditionallyPerform("buttonClicked",a)};b.style.cursor="pointer"}});CheckBox=View.clone().newSlots({type:"CheckBox",elementName:"input",checked:false}).setSlots({init:function(){View.init.call(this);this.sizeToFit()},initElement:function(){View.initElement.call(this);var a=this;var b=this.element();b.type="checkbox";b.onclick=function(c){a.setChecked(a.element().checked)}},setChecked:function(a){if(this.checked()!=a){this._checked=a;this.element().checked=a;this.delegatePerform("checkBoxChanged")}},toggleChecked:function(){this.setChecked(!this.checked())},sizeToFit:function(){View.sizeToFit.call(this);this.setWidth(this.width()+2);this.setHeight(this.height()+2)},value:function(){return this.checked()},setValue:function(a){this.setChecked(a)}});DropDown=View.clone().newSlots({type:"DropDown",elementName:"select",}).setSlots({initElement:function(){View.initElement.call(this);var a=this;var b=this.element();b.onchange=function(c){a.delegate()&&a.delegate().conditionallyPerform("dropDownChanged",a)}},setOptions:function(a){var b=this.element();b.innerHTML="";a.forEach(function(d){var c=document.createElement("option");c.value=d;c.innerText=d;select=b;b.appendChild(c)})},selectedOption:function(){var a=Array.prototype.slice.call(this.element().options).detect(function(b){return b.selected});return a&&a.value},setSelectedOption:function(a){Array.prototype.slice.call(this.element().options).forEach(function(b){b.selected=b.value==a?"selected":""})},value:function(){return this.selectedOption()},setValue:function(a){this.setSelectedOption(a)}});ScrollView=View.clone().newSlots({type:"ScrollView",contentView:null}).setSlots({init:function(){View.init.call(this);this.setContentView(View.clone())},initElement:function(){View.initElement.call(this);this.element().style.overflow="auto"},setContentView:function(a){this.removeSubview(this._contentView);this.addSubview(a);this._contentView=a;return this},scrollToBottom:function(){this.element().scrollTop=this.contentView().height()-this.height()}});TitledView=View.clone().newSlots({type:"TitledView",title:"",titleBar:null,contentView:null}).setSlots({init:function(){View.init.call(this);var c=Label.clone();c.setText("Title Bar");c.sizeToFit();c.resizeCentered();var b=View.clone();b.setBackgroundColor(Color.LightGray);b.setWidth(c.width()+c.fontSize());b.setHeight(c.height()+c.fontSize());b.setResizesWidth(true);b.addSubview(c);b.newSlot("label",c);c.center();this.setTitleBar(b);var d=View.clone();d.setWidth(b.width());d.setHeight(1);d.setY(b.height());d.setResizesWidth(true);d.setResizesHeight(true);this.setContentView(d);this.setWidth(b.width());this.setHeight(b.height()+d.height());var e=View.clone();e.setBackgroundColor(Color.Gray);e.setY(b.height());e.setWidth(b.width());e.setHeight(1);e.setResizesWidth(true);var a=View.clone();a.setBackgroundColor(Color.Gray);a.setX(this.width()-1);a.setWidth(1);a.setHeight(this.height());a.setResizesLeft(true);a.setResizesHeight(true);this.addSubview(b);this.addSubview(e);this.addSubview(d);this.addSubview(a)},setTitle:function(b){var a=this.titleBar().label();a.setText(b);a.sizeToFit();a.center();this._title=b}});TableView=View.clone().newSlots({type:"TableView",rows:[],vMargin:7,hMargin:7,colAlignments:[],rowAlignments:[],}).setSlots({init:function(){View.init.call(this);this.setRows(this.rows().copy());this.setRowAlignments(this.rowAlignments().copy());this.setColAlignments(this.colAlignments().copy())},ColAlignmentLeft:"left",ColAlignmentCenter:"center",ColAlignmentRight:"right",RowAlignmentTop:"top",RowAlignmentMiddle:"middle",RowAlignmentBottom:"bottom",row:function(b){var a=this.rows()[b];if(!a){a=[];this.rows()[b]=a}return a},addAtRowCol:function(b,f,c){var d=this.rows();var e=this.row(f);var a=e[c];if(a){this.removeAtRowCol(f,c)}e[c]=b;this.addSubview(b);this.applyLayout()},removeAtRowCol:function(d,b){var c=this.row(d);var a=c[b];if(a){this.removeSubview(a);c[d][b]=null}this.applyLayout()},empty:function(){this.setRows([]);this.removeAllSubviews()},viewAtRowCol:function(b,a){return this.row(b)[a]},colCount:function(){return this.rows().map(function(a){return(a&&a.length)||0}).max()},colWidth:function(a){return this.rows().map(function(b){return(b[a]||View.clone()).width()}).max()},rowCount:function(){return this.rows().length},rowHeight:function(a){return this.rows()[a].map(function(b){return(b||View.clone()).height()}).max()},alignRow:function(a,b){this.rowAlignments()[a]=b},alignCol:function(a,b){this.colAlignments()[a]=b},rowAlignment:function(a){return this.rowAlignments()[a]||TableView.RowAlignmentBottom},colAlignment:function(a){return this.colAlignments()[a]||TableView.ColAlignmentCenter},applyLayout:function(){var i=this;this.setWidth(this.colCount().map(function(c){return i.colWidth(c)}).sum()+this.hMargin()*(this.colCount()+1));this.setHeight(this.rowCount().map(function(c){return i.rowHeight(c)}).sum()+this.vMargin()*(this.rowCount()+1));var k=this.rows();for(var b=0;b<this.rowCount();b++){var j=k[b];var d=this.rowAlignment(b);for(var e=0;e<this.colCount();e++){var g=this.colAlignment(e);var h=this.viewAtRowCol(b,e);if(h){var a=this.hMargin()+e*this.hMargin()+e.map(function(l){return i.colWidth(l)}).sum();if(g==TableView.ColAlignmentLeft){h.setX(a)}else{if(g==TableView.ColAlignmentCenter){h.setX(a+(this.colWidth(e)-h.width())/2)}else{h.setX(a+this.colWidth(e)-h.width())}}var f=this.vMargin()+b*this.vMargin()+b.map(function(l){return i.rowHeight(b)}).sum();if(d==TableView.RowAlignmentTop){h.setY(f)}else{if(d==TableView.RowAlignmentMiddle){h.setY(f+(this.rowHeight(b)-h.height())/2)}else{h.setY(f+this.rowHeight(b)-h.height())}}}}}}});VerticalListContentView=View.clone().newSlots({type:"VerticalListContentView",items:[],selectedItemIndex:null,itemHMargin:15,itemVMargin:15}).setSlots({init:function(){View.init.call(this);this.setItems(this.items().copy())},addItemWithText:function(f){var d=VerticalListContentView.itemHMargin();var e=VerticalListContentView.itemVMargin();var c=Label.clone();c.setColor(Color.Gray);c.setText(f);c.setWidth(this.width()-2*d);c.sizeHeightToFit();c.setX(d);var a=Button.clone();a.newSlot("label",c);a.setDelegate(this);a.setWidth(this.width());a.setHeight(c.height()+d);a.addSubview(c);c.centerVertically();this.addItem(a)},addItem:function(a){a.newSlot("itemIndex",this.items().length);a.setY(a.itemIndex()*a.height());this.setHeight(a.bottomEdge());this.addSubview(a);this.items().append(a)},removeLastItem:function(){var a=this.items().pop();this.removeSubview(a);this.setHeight(this.height()-a.height())},buttonClicked:function(b){if(this.selectedItemIndex()!==null){var a=this.items()[this.selectedItemIndex()].label();a.setColor(Color.Gray);a.setFontWeight("normal")}var a=b.label();a.setColor(Color.Black);a.setFontWeight("bold");this.setSelectedItemIndex(b.itemIndex());this.delegatePerform("vlcvSelectedItem",b)},selectItem:function(a){this.buttonClicked(a)}});VerticalListView=TitledView.clone().newSlots({type:"VerticalListView",scrollView:null,controlsView:null,addButton:null,defaultItemText:"New Item"}).setSlots({init:function(){TitledView.init.call(this);var f=Button.clone();f.setFontWeight("bold");f.setText("+");f.setColor(Color.DimGray);f.sizeToFit();f.setX(f.fontSize());f.setY(f.fontSize()/2);f.setDelegate(this);this.setAddButton(f);var b=Math.max(f.width()+2*f.fontSize(),this.titleBar().width());var g=VerticalListContentView.clone();g.setWidth(b);g.setResizesWidth(true);g.setDelegate(this);var e=ScrollView.clone();e.setWidth(b);e.setHeight(1);e.setResizesHeight(true);e.setResizesWidth(true);e.setContentView(g);this.setScrollView(e);var d=View.clone();d.setBackgroundColor(Color.LightGray);d.setY(e.height());d.setWidth(b);d.setHeight(f.height()+0.5*f.fontSize());d.setResizesWidth(true);d.setResizesTop(true);this.setControlsView(d);var a=View.clone();a.setBackgroundColor(Color.Gray);a.setY(d.y()-1);a.setWidth(b);a.setHeight(1);a.setResizesTop(true);a.setResizesWidth(true);this.setWidth(b);this.setHeight(this.titleBar().height()+e.height()+d.height());var c=this.contentView();c.addSubview(e);c.addSubview(d);c.addSubview(a);c.addSubview(f)},buttonClicked:function(){var d=VerticalListContentView.itemHMargin();var f=VerticalListContentView.itemVMargin();var b=TextField.clone();b.setText(this.defaultItemText());b.setWidth(this.width()-2*d);b.sizeHeightToFit();b.setX(d);b.setDelegate(this);var e=View.clone();e.setWidth(this.width());e.setHeight(b.height()+f);e.addSubview(b);b.centerVertically();var a=this.scrollView();var c=a.contentView();c.addItem(e);this.scrollView().scrollToBottom();b.focus();b.selectAll();if(!this.shouldDockButton()){this.addButton().setHidden(true)}},textFieldShouldEndEditing:function(a){return !(this.delegate()&&this.delegate().canPerform("vlvShouldAddItemWithText"))||this.delegatePerform("vlvShouldAddItemWithText",a.text())},textFieldEditingEnded:function(a){var b=this.scrollView().contentView();b.removeLastItem();b.addItemWithText(a.text());b.buttonClicked(b.items().last());this.scrollView().scrollToBottom()},shouldDockButton:function(){return(this.scrollView().contentView().height()+this.addButton().height())>this.scrollView().height()},vlcvSelectedItem:function(b,a){if(this.shouldDockButton()){this.addButton().setY(this.scrollView().height()+this.controlsView().height()/2-this.addButton().height()/2-2);this.addButton().setResizesTop(true);this.addButton().setResizesBottom(false)}else{this.addButton().setY(this.scrollView().contentView().height());this.addButton().setResizesTop(false);this.addButton().setResizesBottom(true)}this.addButton().setHidden(false);this.delegatePerform("vlvSelectedItem",a)},selectFirstItem:function(){var b=this.scrollView().contentView();var a=b.items().first();if(a){b.selectItem(a)}},selectItemWithTitle:function(c){var b=this.scrollView().contentView();var a=b.items().detect(function(d){return d.label().text()==c});if(a){b.selectItem(a)}},cancelAdd:function(){this.addButton().setHidden(false);this.scrollView().contentView().removeLastItem()}});Editable=Proto.clone().newSlots({type:"Editable",watchesSlots:true,editableSlotDescriptions:{},editableSlots:null}).setSlots({init:function(){this.setEditableSlotDescriptions(Object_clone(this.editableSlotDescriptions()))},newEditableSlot:function(a,b){this.newSlot(a,b);this["set"+a.asCapitalized()]=function(d){var c=this["_"+a];if(c!=d){this["_"+a]=d;if(this.watchesSlots()){this.conditionallyPerform("slotChanged",a,c,d)}}return this}},editableSlots:function(){if(!this._editableSlots){this._editableSlots=[];for(var a in this.editableSlotDescriptions()){var c=this.editableSlotDescriptions()[a];var b=window["Editable"+c.control.type.asCapitalized()+"Slot"].clone();var d=Object_shallowCopy(c.control);delete d.type;b.performSets(d);b.setName(a);b.setObject(this);this.editableSlots().append(b)}}return this._editableSlots},newEditableSlots:function(b){this.setEditableSlotDescriptions(b);for(var a in this.editableSlotDescriptions()){var c=this.editableSlotDescriptions()[a];this.newEditableSlot(a,c.value)}return this}});EditableCheckBoxSlot=EditableSlot.clone().newSlots({type:"EditableCheckBoxSlot",controlProto:CheckBox}).setSlots({checkBoxChanged:function(a){this.updateValue()}});EditableSlot=Proto.clone().newSlots({type:"EditableSlot",object:null,name:null,label:null,control:null,slotEditorView:null,controlProto:TextField}).setSlots({label:function(){if(!this._label){var a=Label.clone();a.setText(this.name());a.sizeToFit();this._label=a}return this._label},control:function(){if(!this._control){var a=this.controlProto().clone();a.setDelegate(this);this._control=a}return this._control},textFieldEditingEnded:function(a){this.updateValue()},updateValue:function(a){this.object().perform("set"+this.name().asCapitalized(),this.control().value())},addTo:function(b){var a=this.object().editableSlots().indexOf(this);b.addAtRowCol(this.label(),a,0);this.control().setValue(this.object().perform(this.name()));this.control().sizeToFit();b.addAtRowCol(this.control(),a,1)}});SlotEditorView=TableView.clone().newSlots({type:"PropertyEditorView",object:null}).setSlots({init:function(){TableView.init.call(this);this.alignCol(0,TableView.ColAlignmentRight);this.alignCol(1,TableView.ColAlignmentLeft)},setObject:function(b){this._object=b;var c=this.rows();this.empty();var a=this;b.editableSlots().forEach(function(d){d.addTo(a)})}});HttpResponse=Proto.clone().newSlots({type:"HttpResponse",body:null,statusCode:null}).setSlots({isSuccess:function(){var a=this.statusCode();return a>=200&&a<300}});HttpRequest=Delegator.clone().newSlots({type:"HttpRequest",method:"GET",body:null,url:null,xmlHttpRequest:null,response:null}).setSlots({init:function(){this.setXmlHttpRequest(new XMLHttpRequest())},start:function(){var a=this;var b=this.xmlHttpRequest();b.open(this.method(),this.url(),true);b.onreadystatechange=function(){if(b.readyState==4){var c=HttpResponse.clone();c.setBody(b.responseText);c.setStatusCode(b.status);a.setResponse(c);a.delegatePerform("httpRequestCompleted")}};b.send(this.body())}});