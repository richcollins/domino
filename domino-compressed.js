Object_clone=function(a){Proto_constructor.prototype=a;return new Proto_constructor};Object_shallowCopy=function(c){var a={};for(var b in c){if(c.hasOwnProperty(b)){a[b]=c[b]}}return a};Arguments_asArray=function(a){return Array.prototype.slice.call(a)};if(!Array.prototype.forEach){Array.prototype.forEach=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var d=arguments[1];for(var c=0;c<a;c++){if(c in this){b.call(d,this[c],c,this)}}}}String.prototype.asCapitalized=function(){return this.replace(/\b[a-z]/g,function(a){return a.toUpperCase()})};Proto=new Object;Proto.setSlot=function(a,b){this[a]=b;return this};Proto.uniqueIdCounter=0;Proto.setSlots=function(b){for(name in b){if(b.hasOwnProperty(name)){var a=b[name];if(typeof(a)=="function"){var c={protoName:this._type,methodName:name};a.functionInfo=c;a.name=this._type+"."+name}this.setSlot(name,a)}}if(b.hasOwnProperty("toString")){this.toString=b.toString}return this};Proto_constructor=new Function;Proto.setSlots({constructor:new Function,clone:function(){Proto_constructor.prototype=this;var a=new Proto_constructor;a._proto=this;a._uniqueId=++Proto.uniqueIdCounter;if(a.init){a.init()}return a},uniqueId:function(){return this._uniqueId},proto:function(){return this._proto},removeSlots:function(){this.argsAsArray(arguments).forEach(function(a){delete this["_"+name];delete this[name];delete this["set"+name.asCapitalized()]});return this},setSlotsIfAbsent:function(a){for(name in a){if(!this[name]&&a.hasOwnProperty(name)){this.setSlot(name,a[name])}}if(a.hasOwnProperty("toString")){this.toString=a.toString}return this},printSlotCalls:function(){var c=[];for(var a in SlotCalls){var d={};d.name=a;d.count=SlotCalls[a];c.push(d)}c.sort(function(e,f){return e.count-f.count});for(var b=0;b<c.length;b++){Logger.log(c[b].name+":"+c[b].count)}},newSlot:function(b,a){if(typeof(b)!="string"){throw"name must be a string"}if(a===undefined){a=null}this["_"+b]=a;this[b]=function(){return this["_"+b]};this["set"+b.asCapitalized()]=function(c){this["_"+b]=c;return this};return this},newLazySlot:function(b,a){this[b]=function(){if(this["_"+b]===undefined){this["_"+b]=a}return this["_"+b]};this["set"+b.asCapitalized()]=function(c){this["_"+b]=c;return this};return this},newLazySlots:function(){var c=this.argsAsArray(arguments);var b={};if(c.length>1||typeof(c[0])=="string"){c.forEach(function(d){b[d]=null})}else{b=c[0]}for(var a in b){this.newLazySlot(a,b[a])}return this},aliasSlot:function(a,b){this[b]=this[a];this["set"+b.asCapitalized()]=this["set"+a.asCapitalized()];return this},argsAsArray:function(a){return Array.prototype.slice.call(a)},newSlots:function(){var c=this.argsAsArray(arguments);var b={};if(c.length>1||typeof(c[0])=="string"){c.forEach(function(d){b[d]=null})}else{b=c[0]}for(var a in b){this.newSlot(a,b[a])}return this},newNumberSlot:function(b,a){this.newSlot(b,a||0);this["inc"+b.asCapitalized()+"By"]=function(c){this["_"+b]+=c};this["inc"+b.asCapitalized()]=function(){this["_"+b]++};this["dec"+b.asCapitalized()+"By"]=function(c){this["_"+b]-=c};this["dec"+b.asCapitalized()]=function(){this["_"+b]--};return this},newNumberSlots:function(){this.argsAsArray(arguments).forEach(function(a){this.newNumberSlot(a)},this);return this},forEachSlot:function(b){for(var a in this){if(this.hasOwnProperty(a)){b(this[a],a)}}return this},canPerform:function(a){return this[a]&&typeof(this[a])=="function"},performWithArgList:function(b,a){return this[b].apply(this,a)},perform:function(a){return this[a].apply(this,this.argsAsArray(arguments).slice(1))},conditionallyPerform:function(a){if(this[a]&&this[a].call){return this.perform.apply(this,arguments)}else{return null}},performSets:function(b){for(var a in b){if(b.hasOwnProperty(a)){this.conditionallyPerform("set"+a.asCapitalized(),b[a])}}return this},slotsObject:function(){var b={};for(var a in this){if(a.beginsWith("_")){b[a.after("_")]=this[a]}}delete b.proto;delete b.sender;delete b.type;delete b.uniqueId;return b}});Proto.newSlot("type","Proto");Proto.newSlot("sender",null);Proto.removeSlot=Proto.removeSlots;Browser=Proto.clone().setSlots({userAgent:function(){if(typeof window!="undefined"&&typeof window.navigator!="undefined"){return window.navigator.userAgent}else{return""}},isInternetExplorer:function(){return navigator.appName.indexOf("Internet Explorer")>-1},isIE8:function(){return this.userAgent().indexOf("MSIE 8.0")!=-1},isIE6:function(){return this.isInternetExplorer()&&!window.XMLHttpRequest},isGecko:function(){return this.userAgent().indexOf("Gecko")!=-1},isSafari:function(){return this.userAgent().indexOf("Safari")!=-1},version:function(){if(this.isGecko()){var a=this.userAgent().indexOf("Firefox");return(a==-1)?2:parseFloat(this.userAgent().substring(a+"Firefox".length+1))}else{return null}},locationAsUri:function(){return Uri.withString(window.location.href)}});(function(){for(var a in Proto){[Array,String,Number,Date].forEach(function(b){if(b==Array&&a=="clone"&&Browser.isInternetExplorer()){b.prototype[a]=function(){throw new Error("You can't clone an Array proto in IE yet.")}}else{b.prototype[a]=Proto[a]}b.clone=function(){return new b}})}})();Importer=Proto.clone().setType("Importer").newSlots({basePath:null,addsTimestamp:false}).setSlots({importPaths:function(d){for(var b=0;b<d.length;b++){if(this.basePath()){var c=this.basePath()+"/"+d[b]}else{var c=d[b]}c=c+".js";var a='<script type="text/javascript" src="'+c+(this.addsTimestamp()?("?"+new Date().getTime()):"")+'"><\/script>';document.write(a)}}});Array.prototype.setSlotsIfAbsent({init:function(){var a=[0,this.length];a.concatInPlace(this.slice());this.splice.apply(this,a)},empty:function(){this.splice(0,this.length);return this},isEmpty:function(){return this.length==0},concatInPlace:function(a){this.push.apply(this,a)},at:function(a){if(a>0){return this[a]}else{return this[this.length+a]}},removeElements:function(a){a.forEach(function(b){this.remove(b)},this);return this},append:function(a){this.push(a);return this},appendAll:function(b){var a=this;b.forEach(function(c){a.push(c)});return this},prepend:function(a){this.unshift(a);return this},remove:function(b){var a=this.indexOf(b);if(a>-1){this.removeAt(a)}return this},removeAt:function(a){this.splice(a,1);return this},copy:function(){return this.slice()},first:function(){return this[0]},rest:function(){var b=this.copy();b.removeFirst();return b},last:function(){return this[this.length-1]},appendIfAbsent:function(){var a=this;this.argsAsArray(arguments).forEach(function(b){if(a.indexOf(b)==-1){a.push(b)}});return this},split:function(e){var c=[];var d=Math.ceil(this.length/e);for(var b=0;b<this.length;b+=d){var f=this.slice(b,b+d);if(f.length<d){var a=c.pop();if(a){f=a.concat(f)}}c.push(f)}return c},map:function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var e=new Array(a);var d=arguments[1];for(var c=0;c<a;c++){if(c in this){e[c]=b.call(d,this[c],c,this)}}return e},shuffle:function(){var b=this.length;if(b==0){return false}while(--b){var a=Math.floor(Math.random()*(b+1));var d=this[b];var c=this[a];this[b]=c;this[a]=d}},forEachCall:function(b){var a=this.argsAsArray(arguments).slice(1);a.push(0);this.forEach(function(d,c){a[a.length-1]=c;d[b].apply(d,a)});return this},forEachPerform:function(){return this.forEachCall.apply(this,arguments)},sortPerform:function(b){var a=this.argsAsArray(arguments).slice(1);return this.sort(function(d,f){var e=d[b].apply(d,a);var c=f[b].apply(f,a);if(e<c){return -1}else{if(c<e){return 1}else{return 0}}})},mapPerform:function(a){var b=this.argsAsArray(arguments).slice(1);b.push(0);return this.map(function(d,c){b[b.length-1]=c;return d[a].apply(d,b)})},detectPerform:function(b){var a=this.argsAsArray(arguments).slice(1);return this.detect(function(d,c){return d[b].apply(d,a)})},reduce:function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}if(a==0&&arguments.length==1){throw new TypeError()}var c=0;if(arguments.length>=2){var d=arguments[1]}else{do{if(c in this){d=this[c++];break}if(++c>=a){throw new TypeError()}}while(true)}for(;c<a;c++){if(c in this){d=b.call(null,d,this[c],c,this)}}return d},filter:function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var e=new Array();var d=arguments[1];for(var c=0;c<a;c++){if(c in this){var f=this[c];if(b.call(d,f,c,this)){e.push(f)}}}return e},filterPerform:function(a){var b=this.argsAsArray(arguments).slice(1);b.push(0);return this.filter(function(d,c){b[b.length-1]=c;return d[a].apply(d,b)})},detect:function(b){for(var a=0;a<this.length;a++){if(b(this[a])){return this[a]}}return null},detectIndex:function(b){for(var a=0;a<this.length;a++){if(b(this[a])){return a}}return null},max:function(f){var a=undefined;var c=undefined;var e=this.length;for(var d=0;d<e;d++){var b=this[d];if(f){b=f(b)}if(a==undefined||b>a){a=b;c=this[d]}}return c},maxIndex:function(f){var a=undefined;var c=0;var e=this.length;for(var d=0;d<e;d++){var b=this[d];if(f){b=f(b)}if(a==undefined||b>a){a=b;c=d}}return c},min:function(f){var a=undefined;var c=undefined;var e=this.length;for(var d=0;d<e;d++){var b=this[d];if(f){b=f(b)}if(a==undefined||b<a){a=b;c=this[d]}}return c},minIndex:function(f){var a=undefined;var c=0;var e=this.length;for(var d=0;d<e;d++){var b=this[d];if(f){b=f(b)}if(a==undefined||b<a){a=b;c=d}}return c},sum:function(f){var a=undefined;var d=0;var e=this.length;for(var c=0;c<e;c++){var b=this[c];if(f){b=f(b)}d=d+b}return d},some:function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var d=arguments[1];for(var c=0;c<a;c++){if(c in this&&b.call(d,this[c],c,this)){return true}}return false},every:function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var d=arguments[1];for(var c=0;c<a;c++){if(c in this&&!b.call(d,this[c],c,this)){return false}}return true},allRespondTrue:function(a){return this.every(function(b){return b.perform(a)})},firstRespondingTrue:function(a){return this.detect(function(b){return b.perform(a)})},indexOf:function(b){var a=this.length;var c=Number(arguments[1])||0;c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c++){if(c in this&&this[c]===b){return c}}return -1},contains:function(a){return this.indexOf(a)>-1},removeFirst:function(){return this.shift()},removeLast:function(){return this.pop()},hasPrefix:function(b){if(this.length<b.length){return false}for(var a=0;a<this.length;a++){if(this[a]!=b[a]){return false}}return true},toString:function(){var b="[";for(var a=0;a<this.length;a++){var c=this[a];if(a!=0){b=b+","}if(typeof(c)=="string"){b=b+'"'+c+'"'}else{b=b+c}}return b+"]"},isEqual:function(b){if(this.length!=b.length){return false}for(var a=0;a<this.length;a++){if(this[a]!=b[a]){return false}}return true},atInsert:function(a,b){this.splice(a,0,b)},size:function(){return this.length},itemAfter:function(a){var b=this.indexOf(a);if(b==-1){return null}b=b+1;if(b>this.length-1){return null}if(this[b]!=undefined){return this[b]}return null},itemBefore:function(a){var b=this.indexOf(a);if(b==-1){return null}b=b-1;if(b<0){return null}if(this[b]){return this[b]}return null}});Number.prototype.setSlots({cssString:function(){return this.toString()},milliseconds:function(){return this},repeat:function(b){for(var a=0;a<this;a++){b(a)}return this},map:function(){var b=[];for(var c=0;c<this;c++){b.push(c)}return Array.prototype.map.apply(b,arguments)},isEven:function(){return this%2==0}});String.prototype.setSlotsIfAbsent({cssString:function(){return this},replaceSeq:function(d,c){var f=this;var e;if(c.contains(d)){throw"substring contains replace string"}while(true){var e=f.replace(d,c);if(e==f){return e}f=e}return this},repeated:function(c){var a="";var b=this;c.repeat(function(){a+=b});return a},isEmpty:function(){return this.length==0},beginsWith:function(a){if(!a){return false}return this.indexOf(a)==0},removePrefix:function(a){return this.substring(this.beginsWith(a)?a.length:0)},endsWith:function(b){var a=this.lastIndexOf(b);return(a>-1)&&(this.lastIndexOf(b)==this.length-b.length)},removeSuffix:function(a){if(this.endsWith(a)){return this.substr(0,this.length-a.length)}else{return this}},trim:function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},hostName:function(){var a=this.removePrefix("http://");return a.slice(0,a.indexOf("/"))},contains:function(a){return this.indexOf(a)>-1},before:function(a){var b=this.indexOf(a);if(b==-1){return null}else{return this.slice(0,b)}},after:function(a){var b=this.indexOf(a);if(b==-1){return null}else{return this.slice(b+a.length)}},asUncapitalized:function(){return this.replace(/\b[A-Z]/g,function(a){return a.toLowerCase()})},asCapitalized:function(){return this.replace(/\b[A-Z]/g,function(a){return a.toUpperCase()})},containsCapitals:function(){return this.search(/[A-Z]/g)>-1},charAt:function(a){return this.slice(a,a+1)},first:function(){return this.slice(0,1)},asNumber:function(){return Number(this)},stringCount:function(a){return this.split(a).length-1},lineCount:function(){return this.stringCount("\n")},pathComponents:function(){return this.split("/")},sansLastPathComponent:function(){var a=this.pathComponents();a.removeLast();return a.join("/")},lastPathComponent:function(){return this.pathComponents().last()},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},fileNameSuffix:function(){var a=this.split(".").last();return a},humanized:function(){var d=[];var e=-1;var c=this.asCapitalized();for(var a=0;a<c.length;a++){if(c.slice(a,a+1).match(/[A-Z]/)){var b=c.slice(e,a);if(b){d.append(b)}e=a}}d.append(c.slice(e,a));return d.join(" ")},base64Encoded:function(){return btoa(this)},base64UrlEncoded:function(){return this.base64Encoded().replace("+","-").replace("/","_").replace("=",",")},base64Decoded:function(){return atob(this)},base64UrlDecoded:function(){return this.replace("-","+").replace("_","/").replace(",","=").base64Decoded()}});NodeWrapper=Proto.clone().newSlots({type:"NodeWrapper",node:null}).setSlots({allAt:function(b){var a=[];var d=this.node();for(var c=0;c<d.childNodes.length;c++){var e=d.childNodes[c];if(e.nodeName==b){a.push(NodeWrapper.clone().setNode(e))}}return a},at:function(a){return this.allAt(a).first()},atts:function(){var e={};var d=this.node();if(d.attributes){for(var c=0;c<d.attributes.length;c++){var b=d.attributes[c];e[b.name]=b.value}}return e},text:function(){return this.node().textContent}});Color=Proto.clone().newSlots({red:0,green:0,blue:0,alpha:1}).setSlots({withRGBA:function(h,f,d,e){var i=this.clone();i.setRed(h);i.setGreen(f);i.setBlue(d);i.setAlpha(e);return i},withRGB:function(d,c,a){return this.withRGBA(d,c,a,1)}});Color.setSlots({Transparent:Color.clone().setAlpha(0),White:Color.clone().setRed(1).setGreen(1).setBlue(1),LightGray:Color.clone().setRed(212/255).setGreen(212/255).setBlue(212/255),Gray:Color.clone().setRed(127/255).setGreen(127/255).setBlue(127/255),DimGray:Color.clone().setRed(105/255).setGreen(105/255).setBlue(105/255),Black:Color.clone(),});Delegator=Proto.clone().newSlots({type:"Delegator",delegate:null,delegatePrefix:null,messagesDelegate:true}).setSlots({init:function(){this.setDelegatePrefix(this.type().asUncapitalized())},delegateWith:function(a){return this.setDelegate(Proto.clone().setSlots(a))},delegateMessageName:function(a){var b=this.delegatePrefix();if(b&&!a.beginsWith(b)){return this.delegatePrefix()+a.asCapitalized()}else{return a}},delegatePerform:function(a){if(this.messagesDelegate()){var b=Arguments_asArray(arguments).slice(1);b.unshift(this);var c=this.delegate();a=this.delegateMessageName(a);if(c&&c.canPerform(a)){return c.performWithArgList(a,b)}}}});StyleSlot=Proto.clone().newSlots({view:null,name:null,styleName:null,value:null,transformation:null}).setSlots({addToView:function(){var a=this.view();var b=this.name();var c=this.styleName();var e=this.value();var d=this.transformation();a[b]=function(){return this["_"+b]};a["set"+b.asCapitalized()]=function(f){this["_"+b]=f;if(d){this.element().style[c]=d.apply(f)}else{this.element().style[c]=f}};a["_"+b]=e;a.styleSlots().append(this)}});ColorTransformation=Proto.clone().setSlots({apply:function(a){return"rgba("+[a.red()*255,a.green()*255,a.blue()*255,a.alpha()].join(",")+")"}});SuffixTransformation=Proto.clone().setSlots({apply:function(a){return a+this.suffix}});RoundedSuffixTransformation=Proto.clone().setSlots({apply:function(a){return Math.round(a)+this.suffix}});View=Delegator.clone().newSlots({type:"View",superview:null,subviews:[],element:null,elementName:"div",resizesLeft:false,resizesRight:false,resizesWidth:false,resizesTop:false,resizesBottom:false,resizesHeight:false,styleSlots:[]}).setSlot("newStyleSlots",function(c){for(var a in c){var e=c[a];var b=StyleSlot.clone();b.setView(this);b.setName(a);b.setStyleName(e.name||a);b.setValue(e.value);if(e.transformation){var d=window[e.transformation.name.asCapitalized()+"Transformation"];if(d){b.setTransformation(d.clone().setSlots(e.transformation))}}b.addToView()}return this}).newStyleSlots({x:{name:"left",value:0,transformation:{name:"roundedSuffix",suffix:"px"}},y:{name:"top",value:0,transformation:{name:"roundedSuffix",suffix:"px"}},width:{value:0,transformation:{name:"roundedSuffix",suffix:"px"}},height:{value:0,transformation:{name:"roundedSuffix",suffix:"px"}},backgroundColor:{value:Color.Transparent,transformation:{name:"color"}},visibility:{value:"visible"},zIndex:{value:0}});View.setSlots({init:function(){Delegator.init.call(this);this.setStyleSlots(this.styleSlots().copy());this.createElement();this.initElement();this.setSubviews(this.subviews().copy())},createElement:function(){var a=document.createElement(this.elementName());a.style.position="absolute";a.style.overflow="hidden";this.setElement(a)},initElement:function(){var a=this;this.styleSlots().forEach(function(b){a.perform("set"+b.name().asCapitalized(),a.perform(b.name()))})},setHidden:function(a){this.setVisibility(a?"hidden":"visible");this.subviews().forEachPerform("setVisibility",this.visibility())},hidden:function(){return this.visibility()=="hidden"},show:function(){this.setHidden(false);return this},hide:function(){this.setHidden(true);return this},addEventListener:function(a,b){var c=this.element();if(c.addEventListener){c.addEventListener(a,b,false)}else{c.attachEvent(a,b)}},preventDefault:function(a){if(a.preventDefault){a.preventDefault()}else{if(a.returnValue){a.returnValue=false}}},removeAllSubviews:function(){var a=this;this.subviews().copy().forEach(function(b){a.removeSubview(b)})},removeSubview:function(a){if(!a){return this}if(a.superview()!=this){throw"view is not a subview"}this.subviews().remove(a);a.setSuperview(null);this.element().removeChild(a.element())},addSubview:function(b){var a=b.superview();if(a){a.removeSubview(b)}b.setSuperview(this);this.subviews().append(b);this.element().appendChild(b.element())},addSubviews:function(){var a=this;Arguments_asArray(arguments).forEach(function(b){a.addSubview(b)})},rightEdge:function(){return this.x()+this.width()},bottomEdge:function(){return this.y()+this.height()},moveRightOf:function(a,b){this.setX(a.rightEdge()+b)},moveBelow:function(a,b){this.setY(a.bottomEdge()+b)},alignTopTo:function(a){this.setY(a.y())},alignMiddleTo:function(a){this.setY(a.y()+0.5*a.height()-0.5*this.height())},alignBottomTo:function(a){this.setY(a.bottomEdge()-this.height()-1)},alignRightTo:function(a){this.setX(a.rightEdge()-this.width()-1)},center:function(){this.centerHorizontally();this.centerVertically();return this},centerHorizontally:function(){var a=this.superview();if(a){this.setX((a.width()-this.width())/2)}},centerVertically:function(){var a=this.superview();if(a){this.setY((a.height()-this.height())/2)}},_setWidth:View.setWidth,setWidth:function(b){var a=this.width();this._setWidth(b);this.subviews().forEachPerform("autoResizeWidth",a)},autoResizeWidth:function(c){var b=this.superview().width();var a=this.width();if(this.resizesLeft()){if(this.resizesRight()){if(this.resizesWidth()){this.setWidth(a*b/c)}this.setX(this.x()*(b-this.width())/(c-a))}else{if(this.resizesWidth()){this.setWidth(a*b/c)}this.setX(this.x()+a+b-this.width()-c)}}else{if(this.resizesRight()){if(this.resizesWidth()){this.setWidth(a*b/c)}}else{if(this.resizesWidth()){this.setWidth(b-(c-a))}}}},_setHeight:View.setHeight,setHeight:function(a){var b=this.height();this._setHeight(a);this.subviews().forEachPerform("autoResizeHeight",b)},autoResizeHeight:function(c){var a=this.superview().height();var b=this.height();if(this.resizesTop()){if(this.resizesBottom()){if(this.resizesHeight()){this.setHeight(b*a/c)}this.setY(this.y()*(a-this.height())/(c-b))}else{if(this.resizesHeight()){this.setHeight(b*a/c)}this.setY(this.y()+b+a-this.height()-c)}}else{if(this.resizesBottom()){if(this.resizesHeight()){this.setHeight(b*a/c)}}else{if(this.resizesHeight()){this.setHeight(a-(c-b))}}}},autoResize:function(b,a){this.autoResizeWidth(b);this.autoResizeHeight(a)},resizeCentered:function(){this.resizeCenteredHorizontally(true);this.resizeCenteredVertically(true)},resizeCenteredHorizontally:function(){this.setResizesLeft(true);this.setResizesRight(true)},resizeCenteredVertically:function(){this.setResizesTop(true);this.setResizesBottom(true)},resizeToFill:function(){this.setResizesWidth(true);this.setResizesHeight(true)},scaleToFitSuperview:function(){var b=this.superview();var a=this.width()/this.height();if(a>b.width()/b.height()){this.setWidth(b.width());this.setHeight(b.width()/a)}else{this.setWidth(b.height()*a);this.setHeight(b.height())}},sizingElement:function(){var b=this.element().cloneNode(true);var a=b.style;a.position="fixed";a.width="";a.height="";a.top=screen.height+"px";document.body.appendChild(b);return b},sizeWidthToFit:function(){var b=this.sizingElement();var a=b.style;this.setWidth(b.clientWidth);document.body.removeChild(b)},sizeHeightToFit:function(){var b=this.sizingElement();var a=b.style;a.width=this.width()+"px";this.setHeight(b.clientHeight);document.body.removeChild(b)},sizeToFit:function(){this.sizeWidthToFit();this.sizeHeightToFit()},moveToBack:function(){this.setZIndex(this.superview().subviews().mapPerform("zIndex").min()-1)}});Window=View.clone().newSlots({type:"Window",lastResizeWidth:null,lastResizeHeight:null,inited:false}).setSlots({init:function(){View.init.call(this);document.body.innerHTML="";this.setLastResizeWidth(this.width());this.setLastResizeHeight(this.height());window.onresize=function(){Window.autoResize()};this.setInited(true);this.delegatePerform("inited")},createElement:function(){this.setElement(document.body)},initElement:function(){},width:function(){return this.element().clientWidth},height:function(){return this.element().clientHeight},autoResize:function(){this.subviews().forEachPerform("autoResize",this.lastResizeWidth(),this.lastResizeHeight());this.setLastResizeWidth(this.width());this.setLastResizeHeight(this.height())}});window.addEventListener("load",function(){Window.init()});Label=View.clone().newSlots({type:"Label",text:null}).newStyleSlots({fontFamily:{value:"Helvetica, Arial, sans-serif"},fontSize:{value:15,transformation:{name:"suffix",suffix:"px"}},fontWeight:{value:"normal"},textDecoration:{value:"none"},color:{value:Color.Black,transformation:{name:"color"}},textOverflow:{value:"ellipsis"},whiteSpace:{value:"pre"},textAlign:{value:"left"},lineHeight:{value:""}}).setSlots({setText:function(a){this._text=a;this.element().innerText=a}});TextField=Label.clone().newSlots({type:"TextField",placeholderText:"Enter Text",placeholderTextColor:Color.LightGray,growsToFit:true}).setSlots({initElement:function(){View.initElement.call(this);var b=this.element();b.contentEditable=true;b.style.outline="none";var a=this;b.onkeydown=function(c){if(c.keyCode==13){a.preventDefault(c);a.element().blur()}a.checkChanged()};b.onpaste=function(c){a.checkChanged()};b.onmouseup=function(c){a.checkChanged()};b.onfocus=function(c){if(a._originalColor){a.setColor(a._originalColor)}setTimeout(function(){a.selectAll()})};b.onblur=function(c){a.setText(a.text());if(!(a.delegate()&&a.delegate().canPerform(a.delegateMessageName("shouldEndEditing")))||a.delegatePerform("shouldEndEditing")){a.delegatePerform("editingEnded",a)}else{setTimeout(function(){a.focus();a.selectAll()})}}},checkChanged:function(){var a=this;setTimeout(function(){if(a.text()!=a._lastText){a._lastText=a.text();if(a.growsToFit()){a.sizeToFit()}console.log("changed");a.delegatePerform("changed")}})},setText:function(a){Label.setText.call(this,a);if(a.strip()==""){this._originalColor=this.color();this.setColor(this.placeholderTextColor());this.element().innerText=this.placeholderText()}else{if(this._originalColor){this.setColor(this._originalColor);delete this._originalColor}}this.checkChanged()},text:function(){var a=this.element().innerText;if(a==this.placeholderText()){return""}else{return a}},sizingElement:function(){var a=Label.sizingElement.call(this);a.contentEditable=false;return a},selectAll:function(){var a=document.createRange();a.selectNodeContents(this.element());var b=window.getSelection();b.removeAllRanges();b.addRange(a)},focus:function(){this.element().focus()},value:function(){return this.text()},setValue:function(a){this.setText(a)}});Button=Label.clone().newSlots({type:"Button"}).setSlots({initElement:function(){View.initElement.call(this);this.setTextAlign("center");var a=this;var b=this.element();b.onclick=function(){a.delegatePerform("clicked")};b.style.cursor="pointer"},simulateClick:function(){var a=document.createEvent("MouseEvents");a.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);this.element().dispatchEvent(a)}});CheckBox=View.clone().newSlots({type:"CheckBox",elementName:"input",checked:false}).setSlots({init:function(){View.init.call(this);this.sizeToFit()},initElement:function(){View.initElement.call(this);var a=this;var b=this.element();b.type="checkbox";b.onclick=function(c){a.setChecked(a.element().checked)}},setChecked:function(a){if(this.checked()!=a){this._checked=a;this.element().checked=a;this.delegatePerform("changed")}},toggleChecked:function(){this.setChecked(!this.checked())},sizeToFit:function(){View.sizeToFit.call(this);this.setWidth(this.width()+2);this.setHeight(this.height()+2)},value:function(){return this.checked()},setValue:function(a){this.setChecked(a)}});DropDown=View.clone().newSlots({type:"DropDown",elementName:"select",}).setSlots({initElement:function(){View.initElement.call(this);var a=this;var b=this.element();b.onchange=function(c){a.delegatePerform("changed")}},setOptions:function(a){var b=this.element();b.innerHTML="";a.forEach(function(d){var c=document.createElement("option");c.value=d;c.innerText=d;select=b;b.appendChild(c)})},selectedOption:function(){var a=Array.prototype.slice.call(this.element().options).detect(function(b){return b.selected});return a&&a.value},setSelectedOption:function(a){Array.prototype.slice.call(this.element().options).forEach(function(b){b.selected=b.value==a?"selected":""})},value:function(){return this.selectedOption()},setValue:function(a){this.setSelectedOption(a)}});ScrollView=View.clone().newSlots({type:"ScrollView",contentView:null}).setSlots({init:function(){View.init.call(this);this.setContentView(View.clone())},initElement:function(){View.initElement.call(this);this.element().style.overflow="auto"},setContentView:function(a){this.removeSubview(this._contentView);this.addSubview(a);this._contentView=a;return this},scrollToBottom:function(){this.element().scrollTop=this.contentView().height()-this.height()}});TitledView=View.clone().newSlots({type:"TitledView",title:"",titleBar:null,contentView:null}).setSlots({init:function(){View.init.call(this);if(Window.inited()){var c=Label.clone();c.setText("Title Bar");c.sizeToFit();c.resizeCentered();var b=View.clone();b.setBackgroundColor(Color.LightGray);b.setWidth(c.width()+c.fontSize());b.setHeight(c.height()+c.fontSize());b.setResizesWidth(true);b.addSubview(c);b.newSlot("label",c);c.center();this.setTitleBar(b);var d=View.clone();d.setWidth(b.width());d.setHeight(1);d.setY(b.height());d.setResizesWidth(true);d.setResizesHeight(true);this.setContentView(d);this.setWidth(b.width());this.setHeight(b.height()+d.height());var e=View.clone();e.setBackgroundColor(Color.Gray);e.setY(b.height());e.setWidth(b.width());e.setHeight(1);e.setResizesWidth(true);var a=View.clone();a.setBackgroundColor(Color.Gray);a.setX(this.width()-1);a.setWidth(1);a.setHeight(this.height());a.setResizesLeft(true);a.setResizesHeight(true);this.addSubview(b);this.addSubview(e);this.addSubview(d);this.addSubview(a)}},setTitle:function(b){var a=this.titleBar().label();a.setText(b);a.sizeToFit();a.center();this._title=b}});TableView=View.clone().newSlots({type:"TableView",rows:[],vMargin:8,hMargin:10,colAlignments:[],rowAlignments:[]}).setSlots({init:function(){View.init.call(this);this.setRows(this.rows().copy());this.setRowAlignments(this.rowAlignments().copy());this.setColAlignments(this.colAlignments().copy())},ColAlignmentLeft:"left",ColAlignmentCenter:"center",ColAlignmentRight:"right",RowAlignmentTop:"top",RowAlignmentMiddle:"middle",RowAlignmentBottom:"bottom",row:function(b){var a=this.rows()[b];if(!a){a=[];this.rows()[b]=a}return a},addAtRowCol:function(b,f,c){var d=this.rows();var e=this.row(f);var a=e[c];if(a){this.removeAtRowCol(f,c)}e[c]=b;this.addSubview(b);this.applyLayout()},removeAtRowCol:function(d,b){var c=this.row(d);var a=c[b];if(a){this.removeSubview(a);c[d][b]=null}this.applyLayout()},empty:function(){this.setRows([]);this.removeAllSubviews()},viewAtRowCol:function(b,a){return this.row(b)[a]},colCount:function(){return this.rows().map(function(a){return(a&&a.length)||0}).max()},colWidth:function(a){return this.rows().map(function(b){return(b[a]||View.clone()).width()}).max()},rowCount:function(){return this.rows().length},rowHeight:function(a){return this.rows()[a].map(function(b){return(b||View.clone()).height()}).max()},alignRow:function(a,b){this.rowAlignments()[a]=b},alignCol:function(a,b){this.colAlignments()[a]=b},rowAlignment:function(a){return this.rowAlignments()[a]||this.defaultRowAlignment()},colAlignment:function(a){return this.colAlignments()[a]||this.defaultColAlignment()},applyLayout:function(){var i=this;this.setWidth(this.colCount().map(function(c){return i.colWidth(c)}).sum()+this.hMargin()*(this.colCount()+1));this.setHeight(this.rowCount().map(function(c){return i.rowHeight(c)}).sum()+this.vMargin()*(this.rowCount()+1));var k=this.rows();for(var b=0;b<this.rowCount();b++){var j=k[b];var d=this.rowAlignment(b);for(var e=0;e<this.colCount();e++){var g=this.colAlignment(e);var h=this.viewAtRowCol(b,e);if(h){var a=this.hMargin()+e*this.hMargin()+e.map(function(l){return i.colWidth(l)}).sum();if(g==TableView.ColAlignmentLeft){h.setX(a)}else{if(g==TableView.ColAlignmentCenter){h.setX(a+(this.colWidth(e)-h.width())/2)}else{h.setX(a+this.colWidth(e)-h.width())}}var f=this.vMargin()+b*this.vMargin()+b.map(function(l){return i.rowHeight(b)}).sum();if(d==TableView.RowAlignmentTop){h.setY(f)}else{if(d==TableView.RowAlignmentMiddle){h.setY(f+(this.rowHeight(b)-h.height())/2)}else{h.setY(f+this.rowHeight(b)-h.height())}}}}}}});TableView.newSlots({defaultColAlignment:TableView.ColAlignmentCenter,defaultRowAlignment:TableView.RowAlignmentMiddle});VerticalListContentView=View.clone().newSlots({type:"VerticalListContentView",items:[],selectedItemIndex:null,itemHMargin:15,itemVMargin:15,confirmsRemove:true}).setSlots({init:function(){View.init.call(this);this.setItems(this.items().copy())},addItemWithText:function(f){var d=VerticalListContentView.itemHMargin();var e=VerticalListContentView.itemVMargin();var c=Label.clone();c.setColor(Color.Gray);c.setText(f);c.setWidth(this.width()-2*d);c.sizeHeightToFit();c.setX(d);var a=Button.clone();a.newSlot("label",c);a.setDelegate(this);a.setWidth(this.width());a.setHeight(c.height()+d);a.addSubview(c);c.centerVertically();this.addItem(a)},addItem:function(a){a.setY(this.items().length*a.height());this.setHeight(a.bottomEdge());this.addSubview(a);this.items().append(a)},removeLastItem:function(){var a=this.items().pop();this.removeSubview(a);this.setHeight(this.height()-a.height())},buttonClicked:function(b){if(this.selectedItemIndex()!==null){var c=this.selectedItem();if(c){var a=c.label();a.setColor(Color.Gray);a.setFontWeight("normal")}}var a=b.label();a.setColor(Color.Black);a.setFontWeight("bold");this.setSelectedItemIndex(this.items().indexOf(b));this.delegatePerform("selectedItem",b)},selectItem:function(a){this.buttonClicked(a)},removeItem:function(b){if(this.confirmsRemove()){if(!confirm("Remove "+b.label().text()+"?")){return}}var a=this.items().indexOf(b);this.items().remove(b);this.items().slice(a).forEach(function(e,d){e.setY(e.y()-b.height())});this.removeSubview(b);this.setHeight(this.height()-b.height());var c=this.items()[a]||this.items().last();if(c){this.selectItem(c)}},selectedItem:function(){return this.items()[this.selectedItemIndex()]},removeSelectedItem:function(){this.removeItem(this.selectedItem())}});VerticalListView=TitledView.clone().newSlots({type:"VerticalListView",scrollView:null,controlsView:null,addButton:null,removeButton:null,defaultItemText:"New Item"}).setSlots({init:function(){TitledView.init.call(this);if(Window.inited()){var f=Button.clone();f.setFontWeight("bold");f.setText("+");f.setColor(Color.DimGray);f.sizeToFit();f.setX(f.fontSize());f.setY(f.fontSize()/2);f.setDelegate(this,"addButton").setDelegatePrefix("addButton");this.setAddButton(f);var h=Button.clone();h.setFontWeight("bold");h.setText("âˆ’");h.setColor(Color.DimGray);h.sizeToFit();h.setX(2*f.fontSize()+f.width()/2);h.setY(f.fontSize()/2);h.setDelegate(this).setDelegatePrefix("removeButton");this.setRemoveButton(h);var b=Math.max(f.width()+h.width()+3*f.fontSize(),this.titleBar().width());var g=VerticalListContentView.clone();g.setWidth(b);g.setResizesWidth(true);g.setDelegate(this);g.setDelegatePrefix("vlcv");var e=ScrollView.clone();e.setWidth(b);e.setHeight(1);e.setResizesHeight(true);e.setResizesWidth(true);e.setContentView(g);this.setScrollView(e);var d=View.clone();d.setBackgroundColor(Color.LightGray);d.setY(e.height());d.setWidth(b);d.setHeight(f.height()+0.5*f.fontSize());d.setResizesWidth(true);d.setResizesTop(true);this.setControlsView(d);var a=View.clone();a.setBackgroundColor(Color.Gray);a.setY(d.y()-1);a.setWidth(b);a.setHeight(1);a.setResizesTop(true);a.setResizesWidth(true);this.setWidth(b);this.setHeight(this.titleBar().height()+e.height()+d.height());var c=this.contentView();c.addSubview(e);c.addSubview(d);c.addSubview(a);c.addSubview(f);c.addSubview(h)}},addButtonClicked:function(){var d=VerticalListContentView.itemHMargin();var f=VerticalListContentView.itemVMargin();var b=TextField.clone();b.setText(this.defaultItemText());b.setWidth(this.width()-2*d);b.sizeHeightToFit();b.setX(d);b.setDelegate(this);var e=View.clone();e.setWidth(this.width());e.setHeight(b.height()+f);e.addSubview(b);b.centerVertically();var a=this.scrollView();var c=a.contentView();c.addItem(e);this.scrollView().scrollToBottom();b.focus();b.selectAll();if(!this.shouldDockButton()){this.addButton().setHidden(true);this.removeButton().setHidden(true)}},vlcv:function(){return this.scrollView().contentView()},removeButtonClicked:function(){var a=this.vlcv().items();var c=a.length;var b=this.vlcv().selectedItem();this.vlcv().removeSelectedItem();if(a.length!=c){this.updateButtons();this.delegatePerform("removedItem",b)}},textFieldShouldEndEditing:function(a){return !(this.delegate()&&this.delegate().canPerform(this.delegateMessageName("shouldAddItemWithText")))||this.delegatePerform("shouldAddItemWithText",a.text())},textFieldEditingEnded:function(a){var b=this.scrollView().contentView();b.removeLastItem();b.addItemWithText(a.text());b.buttonClicked(b.items().last());this.scrollView().scrollToBottom()},shouldDockButton:function(){return(this.scrollView().contentView().height()+this.addButton().height())>this.scrollView().height()},updateButtons:function(){if(this.shouldDockButton()){this.addButton().setY(this.scrollView().height()+this.controlsView().height()/2-this.addButton().height()/2-2);this.addButton().setResizesTop(true);this.addButton().setResizesBottom(false);this.removeButton().setY(this.scrollView().height()+this.controlsView().height()/2-this.removeButton().height()/2-2);this.removeButton().setResizesTop(true);this.removeButton().setResizesBottom(false)}else{this.addButton().setY(this.scrollView().contentView().height());this.addButton().setResizesTop(false);this.addButton().setResizesBottom(true);this.removeButton().setY(this.scrollView().contentView().height());this.removeButton().setResizesTop(false);this.removeButton().setResizesBottom(true)}this.addButton().setHidden(false);this.removeButton().setHidden(this.vlcv().items().length==0)},vlcvSelectedItem:function(b,a){this.updateButtons();this.delegatePerform("vlvSelectedItem",a)},selectFirstItem:function(){var b=this.scrollView().contentView();var a=b.items().first();if(a){b.selectItem(a)}},selectItemWithTitle:function(c){var b=this.scrollView().contentView();var a=b.items().detect(function(d){return d.label().text()==c});if(a){b.selectItem(a)}},cancelAdd:function(){this.addButton().setHidden(false);this.removeButton().setHidden(false);this.scrollView().contentView().removeLastItem()},isEmpty:function(){return this.vlcv().items().length==0}});ImageView=View.clone().newSlots({type:"ImageView",url:null,elementName:"img"}).setSlots({setUrl:function(a){this._url=a;this.element().src=a;return this}});BorderedButton=Button.clone().newSlots({type:"BorderedButton",borderImageUrl:null,leftBorderWidth:0,rightBorderWidth:0,topBorderWidth:0,bottomBorderWidth:0}).setSlots({setBorderImageUrl:function(a){this._borderImageUrl=a;this.updateStyle();return this},setLeftBorderWidth:function(a){this._leftBorderWidth=a;this.updateStyle();return this},setRightBorderWidth:function(a){this._rightBorderWidth=a;this.updateStyle();return this},setTopBorderWidth:function(a){this._topBorderWidth=a;this.updateStyle();return this},setBottomBorderWidth:function(a){this._bottomBorderWidth=a;this.updateStyle();return this},setWidth:function(a){this._width=a;this.updateStyle();return this},setHeight:function(a){this._height=a;this.updateStyle();return this},updateStyle:function(){var b=this.element().style;var c=[this.topBorderWidth(),this.rightBorderWidth(),this.bottomBorderWidth(),this.leftBorderWidth()];b.webkitBorderImage="url("+this.borderImageUrl()+") "+c.join(" ");c=c.map(function(d){return d+"px"});b.borderWidth=c.join(" ");b.width=(this.width()-this.leftBorderWidth()-this.rightBorderWidth())+"px";var a=(this.height()-this.topBorderWidth()-this.bottomBorderWidth());b.height=a+"px";b.lineHeight=a+"px"}});ImageButton=Button.clone().newSlots({type:"ImageButton",imageUrl:null,imageView:null}).setSlots({init:function(){Button.init.call(this);this.setWidth(3);this.setHeight(3);var a=ImageView.clone();a.setWidth(3);a.setHeight(3);a.resizeToFill();this.setImageView(a);this.addSubview(a)},setImageUrl:function(a){this.imageView().setUrl(a)}});VideoView=View.clone().newSlots({type:"VideoView",url:null,nativeWidth:null,nativeHeight:null,duration:null,elementName:"video",inline:false,canPlay:false}).setSlots({initElement:function(){View.initElement.call(this);var a=this;var b=this.element();this.addEventListener("canplay",function(){a.setCanPlay(true);a.delegatePerform("canPlay")});this.addEventListener("timeupdate",function(){a.delegatePerform("advanced")});this.addEventListener("pause",function(){a.delegatePerform("paused")});this.addEventListener("ended",function(){a.delegatePerform("ended")});this.addEventListener("loadedmetadata",function(){a.setNativeWidth(b.videoWidth);a.setNativeHeight(b.videoHeight);a.setDuration(b.duration);a.delegatePerform("loadedMetaData")})},setUrl:function(a){this._url=a;this.element().src=a;return this},currentTime:function(){return this.element().currentTime},setCurrentTime:function(a){return this.element().currentTime=a},setInline:function(a){this._inline=a;if(a){this.element().setAttribute("webkit-playsinline","")}else{this.element().removeAttribute("webkit-playsinline")}},load:function(){this.setInline(this.inline());this.element().load()},play:function(){this.setInline(this.inline());this.element().play()},pause:function(){this.element().pause()},mute:function(){this.element().muted=true}});Editable=Proto.clone().newSlots({type:"Editable",watchesSlots:true,editableSlotDescriptions:{},editableSlots:null}).setSlots({init:function(){this.setEditableSlotDescriptions(Object_clone(this.editableSlotDescriptions()))},newEditableSlot:function(a,b){this.newSlot(a,b);this["set"+a.asCapitalized()]=function(d){var c=this["_"+a];if(c!=d){this["_"+a]=d;if(this.watchesSlots()){this.conditionallyPerform("slotChanged",a,c,d)}}return this}},editableSlots:function(){if(!this._editableSlots){this._editableSlots=[];for(var a in this.editableSlotDescriptions()){var c=this.editableSlotDescriptions()[a];var b=window["Editable"+c.control.type.asCapitalized()+"Slot"].clone();var d=Object_shallowCopy(c.control);delete d.type;b.control().performSets(d);b.setName(a);b.setObject(this);this.editableSlots().append(b)}}return this._editableSlots},newEditableSlots:function(b){this.setEditableSlotDescriptions(b);for(var a in this.editableSlotDescriptions()){var c=this.editableSlotDescriptions()[a];this.newEditableSlot(a,c.value)}return this},asObject:function(){var a={};this.editableSlots().forEach(function(b){a[b.name()]=b.value()});return a},asJson:function(){return JSON.stringify(this.asObject())}});EditableSlot=Proto.clone().newSlots({type:"EditableSlot",object:null,name:null,label:null,control:null,slotEditorView:null,controlProto:null}).setSlots({label:function(){if(!this._label){var a=Label.clone();a.setText(this.name().humanized());a.sizeToFit();this._label=a}return this._label},control:function(){if(!this._control){var a=this.controlProto().clone();a.setDelegate(this);this._control=a}return this._control},updateValue:function(a){this.object().perform("set"+this.name().asCapitalized(),this.control().value())},value:function(){return this.object().perform(this.name())},addTo:function(b){var a=this.object().editableSlots().indexOf(this);b.addAtRowCol(this.label(),a,0);this.control().setValue(this.value());this.control().sizeToFit();b.addAtRowCol(this.control(),a,1);this.setSlotEditorView(b)}});EditableCheckBoxSlot=EditableSlot.clone().newSlots({type:"EditableCheckBoxSlot",controlProto:CheckBox}).setSlots({checkBoxChanged:function(a){this.updateValue()}});EditableDropDownSlot=EditableSlot.clone().newSlots({type:"EditableDropDownSlot",controlProto:DropDown}).setSlots({dropDownChanged:function(a){this.updateValue()}});EditableTextFieldSlot=EditableSlot.clone().newSlots({type:"EditableTextFieldSlot",controlProto:TextField}).setSlots({textFieldChanged:function(a){this.slotEditorView().applyLayout()},textFieldEditingEnded:function(a){this.updateValue()}});SlotEditorView=TableView.clone().newSlots({type:"PropertyEditorView",object:null}).setSlots({init:function(){TableView.init.call(this);this.alignCol(0,TableView.ColAlignmentRight);this.alignCol(1,TableView.ColAlignmentLeft)},setObject:function(b){if(!b){this.empty()}else{this._object=b;var c=this.rows();this.empty();var a=this;b.editableSlots().forEach(function(d){d.addTo(a)})}},midX:function(){return this.colWidth(0)+this.hMargin()+this.hMargin()/2}});HttpResponse=Proto.clone().newSlots({type:"HttpResponse",body:null,statusCode:null}).setSlots({isSuccess:function(){var a=this.statusCode();return a>=200&&a<300}});HttpRequest=Delegator.clone().newSlots({type:"HttpRequest",method:"GET",body:null,url:null,xmlHttpRequest:null,response:null}).setSlots({init:function(){Delegator.init.call(this);this.setXmlHttpRequest(new XMLHttpRequest())},start:function(){var a=this;var b=this.xmlHttpRequest();b.open(this.method(),this.url(),true);b.onreadystatechange=function(){if(b.readyState==4){var c=HttpResponse.clone();c.setBody(b.responseText);c.setStatusCode(b.status);a.setResponse(c);a.delegatePerform("completed")}};b.send(this.body())}});App=Proto.clone().newSlots({type:"App"}).setSlots({init:function(){Window.setDelegate(this)},windowInited:function(){this.start()}});